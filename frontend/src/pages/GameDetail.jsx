import React,{useEffect,useState} from 'react'
import { useParams, Link } from 'react-router-dom'
const API=import.meta.env.VITE_API_BASE||'http://localhost:4000/api'
function Section({title,children}){return(<section className='mt-6'><h3 className='text-lg font-semibold mb-2'>{title}</h3><div className='rounded-2xl bg-slate-900 p-4'>{children}</div></section>)}
export default function GameDetail(){const{id}=useParams();const[meta,setMeta]=useState(null);const[injuries,setInjuries]=useState(null);const[tendencies,setTendencies]=useState(null);const[spotlights,setSpotlights]=useState(null);const[error,setError]=useState(null);useEffect(()=>{fetch(`${API}/games/${id}`).then(r=>r.json()).then(setMeta).catch(e=>setError(String(e)));fetch(`${API}/games/${id}/injuries`).then(r=>r.json()).then(setInjuries).catch(()=>{});fetch(`${API}/games/${id}/tendencies`).then(r=>r.json()).then(setTendencies).catch(()=>{});fetch(`${API}/games/${id}/spotlights`).then(r=>r.json()).then(setSpotlights).catch(()=>{})},[id]);if(error)return <div className='max-w-5xl mx-auto p-6 text-red-400'>Error: {error}</div>;if(!meta)return <div className='max-w-5xl mx-auto p-6'>Loading…</div>;return(<div className='max-w-5xl mx-auto p-6'><Link to='/' className='text-sm opacity-80'>← Back to games</Link><h1 className='text-3xl font-bold mt-2'>{meta.away_team} @ {meta.home_team}</h1><div className='opacity-80 mt-1'>{new Date(meta.kickoff_ts).toLocaleString()} • {meta.venue||'TBD venue'}</div><Section title='Injuries'>{injuries?<div className='text-sm'>{(injuries.players||[]).length?injuries.players.map(p=>(<div key={p.player_id} className='py-2 border-b border-slate-800 last:border-none'><div className='font-medium'>{p.name} <span className='opacity-70'>({p.pos||p.position||'—'})</span></div><div className='opacity-80'>{p.status} — {p.detail||p.description}</div></div>)):<div className='opacity-70'>No recent injuries recorded.</div>}</div>:<div className='opacity-70'>Loading…</div>}</Section><Section title='Tendencies'>{tendencies?<pre className='text-sm whitespace-pre-wrap'>{JSON.stringify(tendencies,null,2)}</pre>:<div className='opacity-70'>Loading…</div>}</Section><Section title='Spotlights'>{spotlights?<div className='grid sm:grid-cols-2 gap-3'>{spotlights.players?.map(pl=>(<div key={pl.player_id} className='rounded-xl border border-slate-800 p-3'><div className='font-medium'>{pl.name} <span className='opacity-70'>({pl.pos})</span></div><div className='opacity-80 text-sm'>Confidence: {pl.confidence?.toFixed?.(1)??pl.confidence}%</div><div className='opacity-80 text-sm mt-1'>{pl.rationale}</div></div>))}</div>:<div className='opacity-70'>Loading…</div>}</Section></div>)}
